# Архитектура для обслуживания 1200 аутрич-email’ов

Нужна система, которая стабильно обслуживает ~1200 отправителей для нескольких клиентов и направлений аутрича, при минимальной стоимости и приемлемой отказоустойчивости. Решение строится вокруг простого ядра, очереди, ротации почтовых ящиков и дешёвой инфраструктуры.

## Компоненты

- Пул доменов и email-адресов. Для каждого клиента/направления используется несколько доменов, на каждом 3–5 почтовых ящиков. Все домены имеют корректные SPF, DKIM и DMARC. DNS через Cloudflare.

- Core-сервис аутрича (Python). Отвечает за кампании, лимиты, health-score ящиков и планирование отправок.

- Очередь (Redis/RabbitMQ). Каждая отправка — задача в очереди.

- Воркеры. Берут задания, выбирают подходящий ящик, отправляют письмо через SMTP, записывают результаты.

- Хранилище. PostgreSQL с регулярными бэкапами в S3-совместимое хранилище.

- Мониторинг. Контроль uptime воркеров, глубины очереди, bounce rate и DNS-настроек.

Минимальная стоимость достигается за счёт использования 1–2 недорогих VPS и дешёвых почтовых провайдеров. Отказоустойчивость — благодаря бэкапам и возможности поднять весь стек из Docker Compose за 10–15 минут в случае сбоя.

## Ротация и мониторинг

Каждый ящик имеет дневные и часовые лимиты, а также health-score. Планировщик равномерно выбирает отправителей по доменам, клиентам и направлениям. Рост bounce, spam-комплейнов или SMTP-ошибок снижает рейтинг ящика; при достижении порога он уходит в карантин. Ночные джобы проверяют DNS, репутацию доменов и аномалии по отправке.

## Распределение нагрузки

1200 почтовых адресов × ~30 писем в день = ~36k отправок/сутки.
Нагрузка равномерно распределяется по дню с рандомными интервалами и строгими rate-limits под конкретных почтовых провайдеров. Домены, клиенты и направления работают изолированно друг от друга.

## Риски и их закрытие

- Выгорание домена и блокировки. Лимиты, warm-up, quarantine, резервные домены.

- Падение VPS. Бэкапы + быстрый подъём из Docker Compose.

- Утечка SMTP-учёток. Секреты в env, ротация паролей.

- Throttling провайдеров. Глобальные и per-provider rate-limits, переключение доменов.

## Примерная стоимость

Инфраструктура:

- VPS (1–2 шт.) — 20–30 $/мес

- PostgreSQL + бэкапы — 10–20 $/мес

- Cloudflare + мониторинг — 0–10 $/мес
  Ядро системы: ~40–60 $/мес

Пул из 1200 email-адресов:
Используются дешёвые почтовые провайдеры (Zoho, Titan, Namecheap).
Обычно 4–5 ящиков на домен → 240–300 доменов × ~1–1.5 $/мес.
Итого: ~250–350 $/мес

Общая стоимость: ~290–410 $/мес
